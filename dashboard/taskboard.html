<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Quadro de Tarefas</title>
<style>
  body {font-family: Arial, sans-serif; background:#1e1e1e; color:#ddd; margin:0; padding:0;}
  .board {display:flex; gap:10px; padding:10px; overflow-x:auto;}
  .column {flex:1; min-width:250px; background:#2b2b2b; border-radius:8px; padding:10px; display:flex; flex-direction:column;}
  .column h2 {margin-top:0; font-size:1.2em; text-align:center;}
  .card {
    background:#3a3a3a;
    border-radius:12px;
    padding:10px;
    margin:5px 0;
    cursor:grab;
    transition:all 0.2s ease;
  }
  .card:hover {
    background:#4a4a4a;
  }
  .card.dragging {
    opacity:0.5;
    transform:scale(1.02);
  }
  .card .title {font-weight:bold;}
  .card .assigned {font-size:0.9em; color:#aaa;}
  .add-task {margin-top:auto; display:flex; gap:5px;}
  .add-task input, .add-task select, .add-task button {padding:5px; border:none; border-radius:4px;}
  .add-task input, .add-task select {flex:1;}
  .add-task button {background:#4caf50; color:#fff; cursor:pointer;}
</style>
</head>
<body>
<h1 style="text-align:center; padding:10px;">Quadro de Tarefas</h1>
<div class="board" id="board">
  <div class="column" data-status="todo">
    <h2>A Fazer</h2>
    <div class="cards" id="todo-cards"></div>
    <div class="add-task">
      <input type="text" id="new-title" placeholder="Título da tarefa" />
      <select id="new-assignee"><option value="Igor">Igor</option><option value="Synthética">Synthética</option></select>
      <button onclick="addTask()">Adicionar</button>
    </div>
  </div>
  <div class="column" data-status="inprogress">
    <h2>Em Progresso</h2>
    <div class="cards" id="inprogress-cards"></div>
    <div class="add-task">
      <input type="text" id="new-title" placeholder="Título da tarefa" />
      <select id="new-assignee"><option value="Igor">Igor</option><option value="Synthética">Synthética</option></select>
      <button onclick="addTask()">Adicionar</button>
    </div>
  </div>
  <div class="column" data-status="done">
    <h2>Concluído</h2>
    <div class="cards" id="done-cards"></div>
    <div class="add-task">
      <input type="text" id="new-title" placeholder="Título da tarefa" />
      <select id="new-assignee"><option value="Igor">Igor</option><option value="Synthética">Synthética</option></select>
      <button onclick="addTask()">Adicionar</button>
    </div>
  </div>
</div>

<script>
const statusToColumn = {
  'Backlog': 'todo',
  'Em Progresso': 'inprogress',
  'Concluído': 'done',
  'Aguardando': 'todo'
};

function renderTasks(tasks) {
  document.querySelectorAll('.column').forEach(col => {
    col.querySelector('.cards').innerHTML = '';
  });

  tasks.forEach(task => {
    const columnKey = statusToColumn[task.status] || 'todo';
    const column = document.querySelector(`.column[data-status="${columnKey}"]`);
    if (!column) return;

    const card = document.createElement('div');
    card.className = 'card';
    card.draggable = true;
    card.dataset.id = task.id;
    card.ondragstart = e => {
      e.dataTransfer.setData('text/plain', task.id);
      card.classList.add('dragging');
    };
    card.ondragend = e => {
      card.classList.remove('dragging');
    };
    const assigned = task.assigned_to || 'Não atribuída';
    card.innerHTML = `<div class="title">${task.title}</div><div class="assigned">Assigned to: ${assigned}</div>`;
    column.querySelector('.cards').appendChild(card);
  });
}

function addTask(){
  const title=document.getElementById('new-title').value.trim();
  const assignee=document.getElementById('new-assignee').value;
  if(!title) return alert('Título requerido');
  const id=Date.now().toString();
  fetch('/tasks', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({id, title, assigned_to: assignee, status: 'Backlog'})
  })
  .then(r => r.json())
  .then(data => {
    fetch('/tasks')
      .then(r => r.json())
      .then(tasks => renderTasks(tasks))
      .catch(err => console.error('Refresh failed', err));
  })
  .catch(err => console.error('Add task failed', err));
}
</script>
</body>
</html>